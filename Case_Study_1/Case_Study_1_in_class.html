<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alexander Koehler">

<title>Scoring 1: Exam: In-Class part</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Case_Study_1_in_class_files/libs/clipboard/clipboard.min.js"></script>
<script src="Case_Study_1_in_class_files/libs/quarto-html/quarto.js"></script>
<script src="Case_Study_1_in_class_files/libs/quarto-html/popper.min.js"></script>
<script src="Case_Study_1_in_class_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Case_Study_1_in_class_files/libs/quarto-html/anchor.min.js"></script>
<link href="Case_Study_1_in_class_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Case_Study_1_in_class_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Case_Study_1_in_class_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Case_Study_1_in_class_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Case_Study_1_in_class_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="Case_Study_1_in_class_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">

<script src="Case_Study_1_in_class_files/libs/pagedtable-1.1/js/pagedtable.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#scoring-in-class-part" id="toc-scoring-in-class-part" class="nav-link active" data-scroll-target="#scoring-in-class-part"><span class="header-section-number">1</span> Scoring In-Class Part</a>
  <ul class="collapse">
  <li><a href="#exercise-3" id="toc-exercise-3" class="nav-link" data-scroll-target="#exercise-3"><span class="header-section-number">1.1</span> Exercise 3:</a></li>
  <li><a href="#exercise-3-desbois-ratios" id="toc-exercise-3-desbois-ratios" class="nav-link" data-scroll-target="#exercise-3-desbois-ratios"><span class="header-section-number">1.2</span> Exercise 3: Desbois Ratios</a>
  <ul class="collapse">
  <li><a href="#fitting-a-full-logistic-regression-model-r1r37" id="toc-fitting-a-full-logistic-regression-model-r1r37" class="nav-link" data-scroll-target="#fitting-a-full-logistic-regression-model-r1r37"><span class="header-section-number">1.2.1</span> Fitting a full logistic regression model: r1:r37</a></li>
  <li><a href="#stepwise-logistic-regression" id="toc-stepwise-logistic-regression" class="nav-link" data-scroll-target="#stepwise-logistic-regression"><span class="header-section-number">1.2.2</span> Stepwise logistic regression</a></li>
  <li><a href="#comparing-full-model-to-stepwise-defined-model" id="toc-comparing-full-model-to-stepwise-defined-model" class="nav-link" data-scroll-target="#comparing-full-model-to-stepwise-defined-model"><span class="header-section-number">1.2.3</span> Comparing full model to stepwise defined model</a></li>
  <li><a href="#hosmer-lemeshow-tests" id="toc-hosmer-lemeshow-tests" class="nav-link" data-scroll-target="#hosmer-lemeshow-tests"><span class="header-section-number">1.2.4</span> Hosmer Lemeshow tests</a></li>
  </ul></li>
  <li><a href="#exercise-4-altman-ratios" id="toc-exercise-4-altman-ratios" class="nav-link" data-scroll-target="#exercise-4-altman-ratios"><span class="header-section-number">1.3</span> Exercise 4: Altman Ratios</a></li>
  <li><a href="#exercise-5-financial-items-lasso" id="toc-exercise-5-financial-items-lasso" class="nav-link" data-scroll-target="#exercise-5-financial-items-lasso"><span class="header-section-number">1.4</span> Exercise 5: Financial items / Lasso</a></li>
  <li><a href="#exercise-6-model-assessment" id="toc-exercise-6-model-assessment" class="nav-link" data-scroll-target="#exercise-6-model-assessment"><span class="header-section-number">1.5</span> Exercise 6: Model Assessment</a></li>
  <li><a href="#exercise-7-decision-boundary-and-data-simulation" id="toc-exercise-7-decision-boundary-and-data-simulation" class="nav-link" data-scroll-target="#exercise-7-decision-boundary-and-data-simulation"><span class="header-section-number">1.6</span> Exercise 7: Decision boundary and data simulation</a>
  <ul class="collapse">
  <li><a href="#fit-a-logistic-regression-y-x1-x2-on-the-training-set-model1" id="toc-fit-a-logistic-regression-y-x1-x2-on-the-training-set-model1" class="nav-link" data-scroll-target="#fit-a-logistic-regression-y-x1-x2-on-the-training-set-model1"><span class="header-section-number">1.6.1</span> Fit a logistic regression (Y ~ x1 + x2) on the training set (model1)</a></li>
  <li><a href="#boundary-decision-and-bayes-classifier" id="toc-boundary-decision-and-bayes-classifier" class="nav-link" data-scroll-target="#boundary-decision-and-bayes-classifier"><span class="header-section-number">1.6.2</span> Boundary decision and bayes classifier</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Scoring 1: Exam: In-Class part</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alexander Koehler </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="scoring-in-class-part" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Scoring In-Class Part</h1>
<section id="exercise-3" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="exercise-3"><span class="header-section-number">1.1</span> Exercise 3:</h2>
<p>Loading data</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data_fin_exam <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'C:/Users/Alex/Documents/GitHub/Scoring_Alex/teaching_Scoring/exam/data/data_fin_exam.rds'</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">glimpse</span>(data_fin_exam)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,353
Columns: 44
$ Y      &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ capx   &lt;dbl&gt; 2.301, 60.223, 4.346, 42.619, 32.169, 0.210, 31.845, 0.275, 952…
$ che    &lt;dbl&gt; 3.132, 12.678, 5.082, 58.623, 63.305, 1.482, 18.014, 1.454, 378…
$ cogs   &lt;dbl&gt; 11.378, 332.119, 385.265, 729.995, 1476.918, 8.116, 180.126, 3.…
$ dp     &lt;dbl&gt; 2.040, 53.072, 4.418, 49.681, 28.066, 0.385, 18.260, 0.191, 484…
$ act    &lt;dbl&gt; 6.351, 181.599, 128.932, 692.991, 597.103, 5.882, 171.237, 5.63…
$ lct    &lt;dbl&gt; 2.976, 128.618, 58.159, 358.271, 335.409, 5.233, 65.142, 1.006,…
$ ebit   &lt;dbl&gt; 2.061, 76.904, 29.493, 105.547, 79.014, 0.475, 32.654, 1.383, 1…
$ ebitda &lt;dbl&gt; 4.101, 129.976, 33.911, 155.228, 107.080, 0.860, 50.914, 1.574,…
$ re     &lt;dbl&gt; 6.873, -106.904, 50.140, 72.500, -31.142, -2.850, 55.968, 3.841…
$ gp     &lt;dbl&gt; 9.212, 174.608, 111.464, 567.290, 349.877, 6.415, 91.762, 5.138…
$ ib     &lt;dbl&gt; 1.789, 0.125, 14.158, 19.444, 44.710, -0.054, 15.811, 0.851, 13…
$ xint   &lt;dbl&gt; 0.003, 77.560, 3.446, 63.775, 20.069, 0.131, 9.980, 0.036, 54.2…
$ dltt   &lt;dbl&gt; 0.000, 867.944, 46.700, 782.249, 433.135, 1.737, 140.175, 0.203…
$ ni     &lt;dbl&gt; 1.789, 0.125, 14.158, 13.833, 39.811, -0.054, 15.811, 0.851, 13…
$ ppent  &lt;dbl&gt; 12.150, 554.296, 9.861, 481.554, 232.132, 1.947, 195.958, 0.774…
$ sale   &lt;dbl&gt; 20.590, 506.727, 496.729, 1297.285, 1826.795, 14.531, 271.888, …
$ seq    &lt;dbl&gt; 7.572, 82.717, 106.510, 1131.989, 464.633, 6.742, 186.312, 5.32…
$ at     &lt;dbl&gt; 20.010, 1230.512, 222.119, 2329.268, 1311.587, 13.961, 420.046,…
$ lt     &lt;dbl&gt; 12.438, 1147.795, 115.609, 1197.279, 846.954, 6.970, 233.734, 1…
$ invt   &lt;dbl&gt; 0.115, 77.086, 43.631, 309.277, 229.805, 1.007, 77.577, 1.300, …
$ rect   &lt;dbl&gt; 3.010, 84.345, 74.763, 258.471, 272.424, 2.979, 60.943, 2.808, …
$ wcap   &lt;dbl&gt; 3.375, 52.981, 70.773, 334.720, 261.694, 0.649, 106.095, 4.633,…
$ mktval &lt;dbl&gt; 14.784000, 0.326250, 217.974375, 1045.883400, 682.119000, 24.40…
$ r1     &lt;dbl&gt; 0.6215892, 0.9327784, 0.5204823, 0.5140151, 0.6457475, 0.499247…
$ r2     &lt;dbl&gt; 1.00000000, 0.08700999, 0.69518961, 0.59135228, 0.51754239, 0.7…
$ r3     &lt;dbl&gt; 0.2392668, 0.1120566, 0.5030664, 0.2992377, 0.3960180, 0.750789…
$ r4     &lt;dbl&gt; 0.1487256, 0.1045240, 0.2618371, 0.1538127, 0.2557276, 0.374829…
$ r5     &lt;dbl&gt; 0.472863568, 0.828254418, 0.258645141, 0.360202433, 0.390019877…
$ r6     &lt;dbl&gt; 1.3501954, 6.5735533, 1.0371869, 2.1105237, 2.4207193, 1.086516…
$ r7     &lt;dbl&gt; 1.02713851, 5.83694332, 0.51541305, 1.47897548, 1.46207096, 0.2…
$ r8     &lt;dbl&gt; 0.3230569, 0.7366100, 0.5217738, 0.6315482, 0.9586483, 0.815744…
$ r11    &lt;dbl&gt; 0.36636995, 0.30342825, 0.63494043, 0.59003332, 0.74796000, 0.1…
$ r12    &lt;dbl&gt; 0.20471916, 0.17708086, 0.15406468, 0.31041972, 0.15396971, 0.0…
$ r14    &lt;dbl&gt; 0.4685876, 0.7082528, 0.4510827, 0.5169923, 0.5617272, 0.889663…
$ r17    &lt;dbl&gt; 0.0002411963, 0.0675730422, 0.0298073679, 0.0532666154, 0.02369…
$ r18    &lt;dbl&gt; 0.0003256622, 0.4441949968, 0.0309158114, 0.1124204551, 0.05736…
$ r21    &lt;dbl&gt; 0.0007315289, 0.5967255493, 0.1016189437, 0.4108472698, 0.18742…
$ r24    &lt;dbl&gt; 0.20494753, 0.10562758, 0.15267042, 0.06664240, 0.08164155, 0.0…
$ r28    &lt;dbl&gt; 0.4451802, 0.7443874, 0.3042328, 0.2736308, 0.3060504, 0.134060…
$ r30    &lt;dbl&gt; 0.1942032132, 0.0007158893, 0.1270185890, 0.0243843537, 0.11378…
$ r32    &lt;dbl&gt; 0.44485454, 0.30019243, 0.27331695, 0.16121032, 0.24869025, 0.1…
$ r36    &lt;dbl&gt; 1.4827399, 6.0072448, 0.8360278, 2.8843748, 2.0421005, 1.259392…
$ r37    &lt;dbl&gt; 0.4603698, 0.1418987, 0.5018211, 0.2435486, 0.2667585, 0.459494…</code></pre>
</div>
</div>
</section>
<section id="exercise-3-desbois-ratios" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="exercise-3-desbois-ratios"><span class="header-section-number">1.2</span> Exercise 3: Desbois Ratios</h2>
<p>Explore data</p>
<p>Descriptive statistics</p>
<p>show correlated features</p>
<p>showing / plotting individual features “interaction” with the response variable</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(data_fin_exam)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,353
Columns: 44
$ Y      &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ capx   &lt;dbl&gt; 2.301, 60.223, 4.346, 42.619, 32.169, 0.210, 31.845, 0.275, 952…
$ che    &lt;dbl&gt; 3.132, 12.678, 5.082, 58.623, 63.305, 1.482, 18.014, 1.454, 378…
$ cogs   &lt;dbl&gt; 11.378, 332.119, 385.265, 729.995, 1476.918, 8.116, 180.126, 3.…
$ dp     &lt;dbl&gt; 2.040, 53.072, 4.418, 49.681, 28.066, 0.385, 18.260, 0.191, 484…
$ act    &lt;dbl&gt; 6.351, 181.599, 128.932, 692.991, 597.103, 5.882, 171.237, 5.63…
$ lct    &lt;dbl&gt; 2.976, 128.618, 58.159, 358.271, 335.409, 5.233, 65.142, 1.006,…
$ ebit   &lt;dbl&gt; 2.061, 76.904, 29.493, 105.547, 79.014, 0.475, 32.654, 1.383, 1…
$ ebitda &lt;dbl&gt; 4.101, 129.976, 33.911, 155.228, 107.080, 0.860, 50.914, 1.574,…
$ re     &lt;dbl&gt; 6.873, -106.904, 50.140, 72.500, -31.142, -2.850, 55.968, 3.841…
$ gp     &lt;dbl&gt; 9.212, 174.608, 111.464, 567.290, 349.877, 6.415, 91.762, 5.138…
$ ib     &lt;dbl&gt; 1.789, 0.125, 14.158, 19.444, 44.710, -0.054, 15.811, 0.851, 13…
$ xint   &lt;dbl&gt; 0.003, 77.560, 3.446, 63.775, 20.069, 0.131, 9.980, 0.036, 54.2…
$ dltt   &lt;dbl&gt; 0.000, 867.944, 46.700, 782.249, 433.135, 1.737, 140.175, 0.203…
$ ni     &lt;dbl&gt; 1.789, 0.125, 14.158, 13.833, 39.811, -0.054, 15.811, 0.851, 13…
$ ppent  &lt;dbl&gt; 12.150, 554.296, 9.861, 481.554, 232.132, 1.947, 195.958, 0.774…
$ sale   &lt;dbl&gt; 20.590, 506.727, 496.729, 1297.285, 1826.795, 14.531, 271.888, …
$ seq    &lt;dbl&gt; 7.572, 82.717, 106.510, 1131.989, 464.633, 6.742, 186.312, 5.32…
$ at     &lt;dbl&gt; 20.010, 1230.512, 222.119, 2329.268, 1311.587, 13.961, 420.046,…
$ lt     &lt;dbl&gt; 12.438, 1147.795, 115.609, 1197.279, 846.954, 6.970, 233.734, 1…
$ invt   &lt;dbl&gt; 0.115, 77.086, 43.631, 309.277, 229.805, 1.007, 77.577, 1.300, …
$ rect   &lt;dbl&gt; 3.010, 84.345, 74.763, 258.471, 272.424, 2.979, 60.943, 2.808, …
$ wcap   &lt;dbl&gt; 3.375, 52.981, 70.773, 334.720, 261.694, 0.649, 106.095, 4.633,…
$ mktval &lt;dbl&gt; 14.784000, 0.326250, 217.974375, 1045.883400, 682.119000, 24.40…
$ r1     &lt;dbl&gt; 0.6215892, 0.9327784, 0.5204823, 0.5140151, 0.6457475, 0.499247…
$ r2     &lt;dbl&gt; 1.00000000, 0.08700999, 0.69518961, 0.59135228, 0.51754239, 0.7…
$ r3     &lt;dbl&gt; 0.2392668, 0.1120566, 0.5030664, 0.2992377, 0.3960180, 0.750789…
$ r4     &lt;dbl&gt; 0.1487256, 0.1045240, 0.2618371, 0.1538127, 0.2557276, 0.374829…
$ r5     &lt;dbl&gt; 0.472863568, 0.828254418, 0.258645141, 0.360202433, 0.390019877…
$ r6     &lt;dbl&gt; 1.3501954, 6.5735533, 1.0371869, 2.1105237, 2.4207193, 1.086516…
$ r7     &lt;dbl&gt; 1.02713851, 5.83694332, 0.51541305, 1.47897548, 1.46207096, 0.2…
$ r8     &lt;dbl&gt; 0.3230569, 0.7366100, 0.5217738, 0.6315482, 0.9586483, 0.815744…
$ r11    &lt;dbl&gt; 0.36636995, 0.30342825, 0.63494043, 0.59003332, 0.74796000, 0.1…
$ r12    &lt;dbl&gt; 0.20471916, 0.17708086, 0.15406468, 0.31041972, 0.15396971, 0.0…
$ r14    &lt;dbl&gt; 0.4685876, 0.7082528, 0.4510827, 0.5169923, 0.5617272, 0.889663…
$ r17    &lt;dbl&gt; 0.0002411963, 0.0675730422, 0.0298073679, 0.0532666154, 0.02369…
$ r18    &lt;dbl&gt; 0.0003256622, 0.4441949968, 0.0309158114, 0.1124204551, 0.05736…
$ r21    &lt;dbl&gt; 0.0007315289, 0.5967255493, 0.1016189437, 0.4108472698, 0.18742…
$ r24    &lt;dbl&gt; 0.20494753, 0.10562758, 0.15267042, 0.06664240, 0.08164155, 0.0…
$ r28    &lt;dbl&gt; 0.4451802, 0.7443874, 0.3042328, 0.2736308, 0.3060504, 0.134060…
$ r30    &lt;dbl&gt; 0.1942032132, 0.0007158893, 0.1270185890, 0.0243843537, 0.11378…
$ r32    &lt;dbl&gt; 0.44485454, 0.30019243, 0.27331695, 0.16121032, 0.24869025, 0.1…
$ r36    &lt;dbl&gt; 1.4827399, 6.0072448, 0.8360278, 2.8843748, 2.0421005, 1.259392…
$ r37    &lt;dbl&gt; 0.4603698, 0.1418987, 0.5018211, 0.2435486, 0.2667585, 0.459494…</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>vars_quanti <span class="ot">&lt;-</span> <span class="fu">names</span>(data_fin_exam <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.numeric))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(var <span class="cf">in</span> vars_quanti){</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    var <span class="ot">&lt;-</span> <span class="fu">as.name</span>(var)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">ggplot</span>(data_fin_exam <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># filter(r17 &lt;0.14) %&gt;% </span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.numeric</span>(Y)<span class="sc">-</span><span class="dv">1</span>), <span class="fu">aes</span>(<span class="at">x=</span><span class="sc">!!</span> var,<span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_jitter</span>(<span class="at">height =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">formula =</span> y <span class="sc">~</span> x,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>), </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col =</span> <span class="st">"dodgerblue"</span>))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-15.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-16.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-17.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-18.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-19.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-20.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-21.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-22.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-23.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-24.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-25.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-26.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-27.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-28.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-29.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-30.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-31.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-32.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-33.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-34.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-35.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-36.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-37.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-38.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-39.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-40.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-41.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-42.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-4-43.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Our data set nearly only has numbers</p>
<p>Additionally, we see that the financial ratios play a larger role, due to them being ratios and not absolute, thus being adjusted for the companies size. Going forward it makes sense to just look at r1:r37</p>
<p>For some variables, such as r37, we observe outliers to the bottom, in this case meaning that they are very unprofitable compared to their assets: r37: Gross Profit / Total Assets.</p>
<p>We also have an unbalanced dataset, few Y=1 compared to Y=0, making our simple logistic regressions unreliable as shown above</p>
<p>we can also try some binning to see how debt servicing might affect the health of the company</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># #r21: Interest Expense / EBITDA</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># class_width &lt;- 0.1</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># (data_fin_exam_binned &lt;- data_fin_exam %&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(balance_bins = cut(r21, breaks = seq(0, 1, class_width),</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                               right = FALSE, dig.lab = 4),</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#            min = floor(r21 / class_width) * class_width,</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#            max = if_else(r21 == 0 , 1, </span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                          # customers with 0$ balance should be long to [0, width) class</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                          # or be excluded</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                          ceiling(r21 / class_width))  * class_width) %&gt;% group_by(balance_bins, min, max, r21) %&gt;% </span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     summarize(n=n()) %&gt;% </span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     pivot_wider(names_from = r21, values_from = n) %&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     replace_na(list(Yes = 0, No = 0)) %&gt;% </span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(`Mean(r21)` = round(Yes / (Yes + No), 4)))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For now, we will use the whole dataset, we might repeat at the end and winsorise the data.</p>
<p>but we will remove collinear features r5, r8, r32. R5 looks very similar to r4, r31 with r28, we can check this with a simple correlation analysis</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We deselect the columns not starting with "r".</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>data_trimmed <span class="ot">&lt;-</span> data_fin_exam <span class="sc">|&gt;</span> <span class="fu">select</span>(Y, <span class="fu">starts_with</span>(<span class="st">'r'</span>)) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>re, <span class="sc">-</span>rect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(data_trimmed <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>Y), <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#view(cor_matrix)</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># go through the matrix, printing variables that have a correlation with another on of higher than 90%, note: used CHATGPT for this</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="fl">0.9</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the dimensions of the correlation matrix</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(cor_matrix)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the matrix and print pairs with correlation higher than 90%</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n<span class="dv">-1</span>)) {</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> (i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n) {</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">abs</span>(cor_matrix[i, j]) <span class="sc">&gt;</span> threshold) {</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Variables"</span>, <span class="fu">colnames</span>(cor_matrix)[i], <span class="st">"and"</span>, <span class="fu">colnames</span>(cor_matrix)[j], </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>          <span class="st">"have a correlation of"</span>, cor_matrix[i, j], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Variables r6 and r7 have a correlation of 0.926985 
Variables r28 and r32 have a correlation of 0.9690406 </code></pre>
</div>
</div>
<p>we thus will further trim variables, r5, r6, r8, r32</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data_trimmed <span class="ot">&lt;-</span> data_trimmed <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="sc">-</span>r5,<span class="sc">-</span>r6,<span class="sc">-</span>r8,<span class="sc">-</span>r32))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_trimmed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Y"],"name":[1],"type":["fct"],"align":["left"]},{"label":["r1"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["r2"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["r3"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["r4"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["r7"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["r11"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["r12"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["r14"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["r17"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["r18"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["r21"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["r24"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["r28"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["r30"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["r36"],"name":[16],"type":["dbl"],"align":["right"]},{"label":["r37"],"name":[17],"type":["dbl"],"align":["right"]}],"data":[{"1":"0","2":"0.6215892","3":"1.00000000","4":"0.2392668","5":"0.1487256","6":"1.0271385","7":"0.3663700","8":"0.20471916","9":"0.4685876","10":"0.0002411963","11":"0.0003256622","12":"0.0007315289","13":"0.20494753","14":"0.4451802","15":"0.1942032132","16":"1.4827399","17":"0.4603698"},{"1":"0","2":"0.9327784","3":"0.08700999","4":"0.1120566","5":"0.1045240","6":"5.8369433","7":"0.3034283","8":"0.17708086","9":"0.7082528","10":"0.0675730422","11":"0.4441949968","12":"0.5967255493","13":"0.10562758","14":"0.7443874","15":"0.0007158893","16":"6.0072448","17":"0.1418987"},{"1":"0","2":"0.5204823","3":"0.69518961","4":"0.5030664","5":"0.2618371","6":"0.5154130","7":"0.6349404","8":"0.15406468","9":"0.4510827","10":"0.0298073679","11":"0.0309158114","12":"0.1016189437","13":"0.15267042","14":"0.3042328","15":"0.1270185890","16":"0.8360278","17":"0.5018211"},{"1":"0","2":"0.5140151","3":"0.59135228","4":"0.2992377","5":"0.1538127","6":"1.4789755","7":"0.5900333","8":"0.31041972","9":"0.5169923","10":"0.0532666154","11":"0.1124204551","12":"0.4108472698","13":"0.06664240","14":"0.2736308","15":"0.0243843537","16":"2.8843748","17":"0.2435486"},{"1":"0","2":"0.6457475","3":"0.51754239","4":"0.3960180","5":"0.2557276","6":"1.4620710","7":"0.7479600","8":"0.15396971","9":"0.5617272","10":"0.0236955018","11":"0.0573601580","12":"0.1874206201","13":"0.08164155","14":"0.3060504","15":"0.1137857018","16":"2.0421005","17":"0.2667585"},{"1":"0","2":"0.4992479","3":"0.77245646","4":"0.7507891","5":"0.3748299","6":"0.2707716","7":"0.1011691","8":"0.04793205","9":"0.8896634","10":"0.0187948350","11":"0.0204208885","12":"0.1523255814","13":"0.06160017","14":"0.1340608","15":"-0.0084177708","16":"1.2593920","17":"0.4594943"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Below is also the winsorise data for later.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># winsorising</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>data_trimmed_winsorised <span class="ot">&lt;-</span> data_trimmed <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(r1<span class="sc">:</span>r37, <span class="sc">~</span> DescTools<span class="sc">::</span><span class="fu">Winsorize</span>(.x , <span class="fu">quantile</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="fitting-a-full-logistic-regression-model-r1r37" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="fitting-a-full-logistic-regression-model-r1r37"><span class="header-section-number">1.2.1</span> Fitting a full logistic regression model: r1:r37</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>full_model_desbois <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> .,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> data_trimmed,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="st">"binomial"</span>) <span class="co"># by default: link = "logit"</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_model_desbois)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Y ~ ., family = "binomial", data = data_trimmed)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -6.20013    1.06076  -5.845 5.07e-09 ***
r1           2.55043    1.14352   2.230  0.02573 *  
r2           0.04335    0.35331   0.123  0.90235    
r3           0.78655    1.07903   0.729  0.46604    
r4           2.02485    1.40293   1.443  0.14894    
r7           0.61574    0.18933   3.252  0.00115 ** 
r11          0.01777    0.19754   0.090  0.92834    
r12         -1.12977    0.44565  -2.535  0.01124 *  
r14         -0.12273    0.31052  -0.395  0.69266    
r17         11.46738    5.06916   2.262  0.02369 *  
r18          0.86921    1.69261   0.514  0.60758    
r21          0.85137    0.20596   4.134 3.57e-05 ***
r24         -2.67192    0.91599  -2.917  0.00353 ** 
r28          0.46147    0.39210   1.177  0.23923    
r30         -0.88447    0.21012  -4.209 2.56e-05 ***
r36         -0.25054    0.12559  -1.995  0.04604 *  
r37         -1.22312    0.57752  -2.118  0.03418 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1765.5  on 4352  degrees of freedom
Residual deviance: 1119.2  on 4336  degrees of freedom
AIC: 1153.2

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</section>
<section id="stepwise-logistic-regression" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="stepwise-logistic-regression"><span class="header-section-number">1.2.2</span> Stepwise logistic regression</h3>
<p>then use stepwise logistic regression (forward or backward, using the penaliza tion/criterion of your choice) (stepwise_model_desbois) on the data set using variables Y and kept features from exploration step among r1:r37.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#define intercept-only model for start</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>intercept_only <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data=</span>data_trimmed, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#define model with all financial ratios</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>all <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y <span class="sc">~</span> ., <span class="at">data=</span>data_trimmed, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># perform forward stepwise regression</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>forward_aic <span class="ot">&lt;-</span> <span class="fu">step</span>(intercept_only, <span class="at">direction=</span><span class="st">'forward'</span>, <span class="at">test =</span> <span class="st">'LRT'</span>, <span class="at">scope=</span><span class="fu">formula</span>(all), <span class="at">k=</span><span class="dv">2</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(forward_aic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Y ~ r1 + r30 + r18 + r4 + r21 + r7 + r24 + r12 + 
    r36 + r37 + r17, family = "binomial", data = data_trimmed)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -5.5356     0.5078 -10.901  &lt; 2e-16 ***
r1            1.8730     0.6299   2.973  0.00294 ** 
r30          -0.7623     0.1699  -4.485 7.27e-06 ***
r18           1.1257     1.6878   0.667  0.50480    
r4            2.8538     0.6656   4.288 1.81e-05 ***
r21           0.8782     0.2043   4.299 1.71e-05 ***
r7            0.6544     0.1680   3.895 9.81e-05 ***
r24          -1.9503     0.7114  -2.741  0.00612 ** 
r12          -1.0791     0.3476  -3.104  0.00191 ** 
r36          -0.2815     0.1057  -2.662  0.00776 ** 
r37          -1.3294     0.5605  -2.372  0.01771 *  
r17          10.5910     5.0307   2.105  0.03527 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1765.5  on 4352  degrees of freedom
Residual deviance: 1121.1  on 4341  degrees of freedom
AIC: 1145.1

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
<p>we see that the optimal formula is:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(forward_aic<span class="sc">$</span>formula)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Y ~ r1 + r30 + r18 + r4 + r21 + r7 + r24 + r12 + r36 + r37 + 
    r17</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>stepwise_model_desbois_formula <span class="ot">&lt;-</span> forward_aic<span class="sc">$</span>formula</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>stepwise_model_desbois <span class="ot">&lt;-</span> <span class="fu">glm</span>(stepwise_model_desbois_formula, <span class="at">data =</span> data_trimmed, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(stepwise_model_desbois)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = stepwise_model_desbois_formula, family = "binomial", 
    data = data_trimmed)

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -5.5356     0.5078 -10.901  &lt; 2e-16 ***
r1            1.8730     0.6299   2.973  0.00294 ** 
r30          -0.7623     0.1699  -4.485 7.27e-06 ***
r18           1.1257     1.6878   0.667  0.50480    
r4            2.8538     0.6656   4.288 1.81e-05 ***
r21           0.8782     0.2043   4.299 1.71e-05 ***
r7            0.6544     0.1680   3.895 9.81e-05 ***
r24          -1.9503     0.7114  -2.741  0.00612 ** 
r12          -1.0791     0.3476  -3.104  0.00191 ** 
r36          -0.2815     0.1057  -2.662  0.00776 ** 
r37          -1.3294     0.5605  -2.372  0.01771 *  
r17          10.5910     5.0307   2.105  0.03527 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1765.5  on 4352  degrees of freedom
Residual deviance: 1121.1  on 4341  degrees of freedom
AIC: 1145.1

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
</section>
<section id="comparing-full-model-to-stepwise-defined-model" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="comparing-full-model-to-stepwise-defined-model"><span class="header-section-number">1.2.3</span> Comparing full model to stepwise defined model</h3>
<p>Compare the full_model_desbois and stepwise_model_desbois using a Likelihood Ratio Test (LRT), ie test if full_model_desbois fits significantly better than the stepwise_model_desbois.</p>
<p>Performing the likelihood ratio test on the two models:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#stepwise_model_desbois</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#full_model_debois</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#using anova from course</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(stepwise_model_desbois, full_model_desbois, <span class="at">test =</span> <span class="st">"LRT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Resid. Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Resid. Dev"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Deviance"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chi)"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"4341","2":"1121.100","3":"NA","4":"NA","5":"NA","_rn_":"1"},{"1":"4336","2":"1119.178","3":"5","4":"1.92153","5":"0.8598928","_rn_":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>we see a pr(&gt;Chi) of 0.8599 such that we cannot reject the null hypothesis of the two models being the same / having the same likelihood. thus the full debois model is not a significant improvement (to the 5% level) to the stepwise and more parsimonius model (the simpler model is statistically “just as good” as the full model)</p>
</section>
<section id="hosmer-lemeshow-tests" class="level3" data-number="1.2.4">
<h3 data-number="1.2.4" class="anchored" data-anchor-id="hosmer-lemeshow-tests"><span class="header-section-number">1.2.4</span> Hosmer Lemeshow tests</h3>
<p>Compare predicted probabilities to observed probabilities for stepwise_model_desbois using either Hosmer &amp; Lemeshow test or a Calibration Plot.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Using code from lecture and usingthe stepwise model</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmtoolbox)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hltest</span>(stepwise_model_desbois)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
   The Hosmer-Lemeshow goodness-of-fit test

 Group Size Observed    Expected
     1  435        2   0.4880202
     2  435        1   1.1373776
     3  435        0   2.0038919
     4  435        5   3.1182072
     5  435        1   4.6780678
     6  435        5   6.9079381
     7  435       10  10.6624972
     8  435       13  17.4399708
     9  435       42  32.5014844
    10  435      142 142.0650825
    11    3        3   2.9974621

         Statistic =  15.54446 
degrees of freedom =  9 
           p-value =  0.077026 </code></pre>
</div>
</div>
<p>with a p-value of 0.077027, we would not reject the null hypothesis at the 5% level that the goodness of fit of the model is acceptable. However, this would not be the case at the 10% level, so there is a good amount of doubt that our model is good, perhaps the winsorising that will be attempted later will help.</p>
<p>However, we know that the Hosmer &amp; Lemeshow test is dependent on the choice of Q and the binning performed on the probabilities and can be unreliable. thus we will iterative through the possible Q.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Calibration</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>check_default_prob <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">cbind</span>(<span class="at">fitted=</span>stepwise_model_desbois<span class="sc">$</span>fitted.values,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">Y =</span> data_trimmed <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"1"</span>, <span class="dv">1</span> , <span class="dv">0</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y)))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>(calibration_data <span class="ot">&lt;-</span> check_default_prob <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bins_prob =</span> <span class="fu">cut</span>(fitted, <span class="at">breaks =</span> <span class="fu">quantile</span>(fitted,<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.10</span>)), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(bins_prob) <span class="sc">%&gt;%</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">def =</span> <span class="fu">sum</span>(Y),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">no_def =</span> n <span class="sc">-</span> def,  </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">predict_prob =</span> <span class="fu">mean</span>(fitted),</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">real_prob =</span> def<span class="sc">/</span>n,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">forecast_acc =</span> def <span class="sc">/</span> <span class="fu">sum</span>(check_default_prob<span class="sc">$</span>Y)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["bins_prob"],"name":[1],"type":["fct"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]},{"label":["def"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["no_def"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["predict_prob"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["real_prob"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["forecast_acc"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"[8.27e-05,0.00183]","2":"436","3":"2","4":"434","5":"0.001123499","6":"0.004587156","7":"0.008928571"},{"1":"(0.00183,0.00351]","2":"435","3":"1","4":"434","5":"0.002618533","6":"0.002298851","7":"0.004464286"},{"1":"(0.00351,0.00578]","2":"435","3":"0","4":"435","5":"0.004611872","6":"0.000000000","7":"0.000000000"},{"1":"(0.00578,0.00878]","2":"435","3":"5","4":"430","5":"0.007175155","6":"0.011494253","7":"0.022321429"},{"1":"(0.00878,0.013]","2":"436","3":"1","4":"435","5":"0.010769129","6":"0.002293578","7":"0.004464286"},{"1":"(0.013,0.0193]","2":"435","3":"5","4":"430","5":"0.015909041","6":"0.011494253","7":"0.022321429"},{"1":"(0.0193,0.0308]","2":"435","3":"10","4":"425","5":"0.024564308","6":"0.022988506","7":"0.044642857"},{"1":"(0.0308,0.052]","2":"435","3":"15","4":"420","5":"0.040189425","6":"0.034482759","7":"0.066964286"},{"1":"(0.052,0.114]","2":"435","3":"40","4":"395","5":"0.075000890","6":"0.091954023","7":"0.178571429"},{"1":"(0.114,1]","2":"436","3":"145","4":"291","5":"0.332189684","6":"0.332568807","7":"0.647321429"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>plotting for better visualisation:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>(calib_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(calibration_data, <span class="fu">aes</span>(<span class="at">x =</span> predict_prob, <span class="at">y =</span> real_prob)) <span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Looks alright from far away, zooming in:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>calib_plot <span class="sc">+</span> <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.05</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>we see quite a bit of divergence at lower probabilities, maybe our model isn’t that good, winsorisation might help.</p>
</section>
</section>
<section id="exercise-4-altman-ratios" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="exercise-4-altman-ratios"><span class="header-section-number">1.3</span> Exercise 4: Altman Ratios</h2>
<ul>
<li><p>first, create new predictors closets to altmans</p></li>
<li><p><img src="images/clipboard-2980047475.png" class="img-fluid"></p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># r24 = EBITA / total assets</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># data_fin_exam was the original dataset</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># we create a new variable to be similar to altmans variables.</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># here for x2, retained earnings / assets. i.e. re / act called re_act</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>data_altman <span class="ot">&lt;-</span> data_fin_exam <span class="sc">|&gt;</span> <span class="fu">mutate</span>( <span class="at">re_act =</span> re <span class="sc">/</span> act)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># sales / total assets: sale_at = sale / at</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>data_altman <span class="ot">&lt;-</span> data_altman <span class="sc">|&gt;</span> <span class="fu">mutate</span>( <span class="at">sale_at =</span> sale <span class="sc">/</span> at)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">#working capital / total assets</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>data_altman <span class="ot">&lt;-</span> data_altman <span class="sc">|&gt;</span> <span class="fu">mutate</span>( <span class="at">wcap_at =</span> wcap <span class="sc">/</span> at)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># marketval of equity / book value of debt</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>data_altman <span class="ot">&lt;-</span> data_altman <span class="sc">|&gt;</span> <span class="fu">mutate</span>( <span class="at">mktval_altt =</span> mktval <span class="sc">/</span> dltt, <span class="at">mktval_altt =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(mktval_altt), <span class="cn">NA</span>, mktval_altt))</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co"># removing nas</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>data_altman <span class="ot">&lt;-</span> data_altman <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(mktval_altt))</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_altman)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Y"],"name":[1],"type":["fct"],"align":["left"]},{"label":["capx"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["che"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["cogs"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["dp"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["act"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["lct"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["ebit"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["ebitda"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["re"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["gp"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["ib"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["xint"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["dltt"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["ni"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["ppent"],"name":[16],"type":["dbl"],"align":["right"]},{"label":["sale"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["seq"],"name":[18],"type":["dbl"],"align":["right"]},{"label":["at"],"name":[19],"type":["dbl"],"align":["right"]},{"label":["lt"],"name":[20],"type":["dbl"],"align":["right"]},{"label":["invt"],"name":[21],"type":["dbl"],"align":["right"]},{"label":["rect"],"name":[22],"type":["dbl"],"align":["right"]},{"label":["wcap"],"name":[23],"type":["dbl"],"align":["right"]},{"label":["mktval"],"name":[24],"type":["dbl"],"align":["right"]},{"label":["r1"],"name":[25],"type":["dbl"],"align":["right"]},{"label":["r2"],"name":[26],"type":["dbl"],"align":["right"]},{"label":["r3"],"name":[27],"type":["dbl"],"align":["right"]},{"label":["r4"],"name":[28],"type":["dbl"],"align":["right"]},{"label":["r5"],"name":[29],"type":["dbl"],"align":["right"]},{"label":["r6"],"name":[30],"type":["dbl"],"align":["right"]},{"label":["r7"],"name":[31],"type":["dbl"],"align":["right"]},{"label":["r8"],"name":[32],"type":["dbl"],"align":["right"]},{"label":["r11"],"name":[33],"type":["dbl"],"align":["right"]},{"label":["r12"],"name":[34],"type":["dbl"],"align":["right"]},{"label":["r14"],"name":[35],"type":["dbl"],"align":["right"]},{"label":["r17"],"name":[36],"type":["dbl"],"align":["right"]},{"label":["r18"],"name":[37],"type":["dbl"],"align":["right"]},{"label":["r21"],"name":[38],"type":["dbl"],"align":["right"]},{"label":["r24"],"name":[39],"type":["dbl"],"align":["right"]},{"label":["r28"],"name":[40],"type":["dbl"],"align":["right"]},{"label":["r30"],"name":[41],"type":["dbl"],"align":["right"]},{"label":["r32"],"name":[42],"type":["dbl"],"align":["right"]},{"label":["r36"],"name":[43],"type":["dbl"],"align":["right"]},{"label":["r37"],"name":[44],"type":["dbl"],"align":["right"]},{"label":["re_act"],"name":[45],"type":["dbl"],"align":["right"]},{"label":["sale_at"],"name":[46],"type":["dbl"],"align":["right"]},{"label":["wcap_at"],"name":[47],"type":["dbl"],"align":["right"]},{"label":["mktval_altt"],"name":[48],"type":["dbl"],"align":["right"]}],"data":[{"1":"0","2":"60.223","3":"12.678","4":"332.119","5":"53.072","6":"181.599","7":"128.618","8":"76.904","9":"129.976","10":"-106.904","11":"174.608","12":"0.125","13":"77.560","14":"867.944","15":"0.125","16":"554.296","17":"506.727","18":"82.717","19":"1230.512","20":"1147.795","21":"77.086","22":"84.345","23":"52.981","24":"0.32625","25":"0.9327784","26":"0.08700999","27":"0.1120566","28":"0.1045240","29":"0.8282544","30":"6.573553","31":"5.8369433","32":"0.7366100","33":"0.3034283","34":"0.17708086","35":"0.7082528","36":"0.06757304","37":"0.44419500","38":"0.5967255","39":"0.10562758","40":"0.7443874","41":"0.0007158893","42":"0.3001924","43":"6.0072448","44":"0.1418987","45":"-0.58868166","46":"0.4118018","47":"0.04305606","48":"3.758883e-04"},{"1":"0","2":"4.346","3":"5.082","4":"385.265","5":"4.418","6":"128.932","7":"58.159","8":"29.493","9":"33.911","10":"50.140","11":"111.464","12":"14.158","13":"3.446","14":"46.700","15":"14.158","16":"9.861","17":"496.729","18":"106.510","19":"222.119","20":"115.609","21":"43.631","22":"74.763","23":"70.773","24":"217.97438","25":"0.5204823","26":"0.69518961","27":"0.5030664","28":"0.2618371","29":"0.2586451","30":"1.037187","31":"0.5154130","32":"0.5217738","33":"0.6349404","34":"0.15406468","35":"0.4510827","36":"0.02980737","37":"0.03091581","38":"0.1016189","39":"0.15267042","40":"0.3042328","41":"0.1270185890","42":"0.2733169","43":"0.8360278","44":"0.5018211","45":"0.38888717","46":"2.2363193","47":"0.31862650","48":"4.667546e+00"},{"1":"0","2":"42.619","3":"58.623","4":"729.995","5":"49.681","6":"692.991","7":"358.271","8":"105.547","9":"155.228","10":"72.500","11":"567.290","12":"19.444","13":"63.775","14":"782.249","15":"13.833","16":"481.554","17":"1297.285","18":"1131.989","19":"2329.268","20":"1197.279","21":"309.277","22":"258.471","23":"334.720","24":"1045.88340","25":"0.5140151","26":"0.59135228","27":"0.2992377","28":"0.1538127","29":"0.3602024","30":"2.110524","31":"1.4789755","32":"0.6315482","33":"0.5900333","34":"0.31041972","35":"0.5169923","36":"0.05326662","37":"0.11242046","38":"0.4108473","39":"0.06664240","40":"0.2736308","41":"0.0243843537","42":"0.1612103","43":"2.8843748","44":"0.2435486","45":"0.10461896","46":"0.5569497","47":"0.14370180","48":"1.337021e+00"},{"1":"0","2":"32.169","3":"63.305","4":"1476.918","5":"28.066","6":"597.103","7":"335.409","8":"79.014","9":"107.080","10":"-31.142","11":"349.877","12":"44.710","13":"20.069","14":"433.135","15":"39.811","16":"232.132","17":"1826.795","18":"464.633","19":"1311.587","20":"846.954","21":"229.805","22":"272.424","23":"261.694","24":"682.11900","25":"0.6457475","26":"0.51754239","27":"0.3960180","28":"0.2557276","29":"0.3900199","30":"2.420719","31":"1.4620710","32":"0.9586483","33":"0.7479600","34":"0.15396971","35":"0.5617272","36":"0.02369550","37":"0.05736016","38":"0.1874206","39":"0.08164155","40":"0.3060504","41":"0.1137857018","42":"0.2486903","43":"2.0421005","44":"0.2667585","45":"-0.05215516","46":"1.3928127","47":"0.19952470","48":"1.574842e+00"},{"1":"0","2":"0.210","3":"1.482","4":"8.116","5":"0.385","6":"5.882","7":"5.233","8":"0.475","9":"0.860","10":"-2.850","11":"6.415","12":"-0.054","13":"0.131","14":"1.737","15":"-0.054","16":"1.947","17":"14.531","18":"6.742","19":"13.961","20":"6.970","21":"1.007","22":"2.979","23":"0.649","24":"24.40107","25":"0.4992479","26":"0.77245646","27":"0.7507891","28":"0.3748299","29":"0.1244180","30":"1.086516","31":"0.2707716","32":"0.8157443","33":"0.1011691","34":"0.04793205","35":"0.8896634","36":"0.01879484","37":"0.02042089","38":"0.1523256","39":"0.06160017","40":"0.1340608","41":"-0.0084177708","42":"0.1136399","43":"1.2593920","44":"0.4594943","45":"-0.48452907","46":"1.0408280","47":"0.04648664","48":"1.404783e+01"},{"1":"0","2":"31.845","3":"18.014","4":"180.126","5":"18.260","6":"171.237","7":"65.142","8":"32.654","9":"50.914","10":"55.968","11":"91.762","12":"15.811","13":"9.980","14":"140.175","15":"15.811","16":"195.958","17":"271.888","18":"186.312","19":"420.046","20":"233.734","21":"77.577","22":"60.943","23":"106.095","24":"197.65350","25":"0.5564486","26":"0.57065672","27":"0.2787014","28":"0.1550830","29":"0.4013656","30":"2.547176","31":"1.8372747","32":"0.7099017","33":"1.1561976","34":"0.50283420","35":"0.3804201","36":"0.04269811","37":"0.10875962","38":"0.1960168","39":"0.12121053","40":"0.5548484","41":"0.1723044397","42":"0.4460888","43":"2.7114601","44":"0.2184570","45":"0.32684525","46":"0.6472815","47":"0.25257948","48":"1.410048e+00"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>“Secondly, fit a logistic regression model model_altman using only these predictors, then:– give an interpretation for the coefficient X3 = EBIT / Total Assets– assess the “significance” of X3 = EBIT / Total Assets coefficient– give a confidence interval for X3 = EBIT / Total Assets”</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model_altman_1 &lt;- glm(Y~z, data = data_trimmed, family = "binomial")</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(model_altman)</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>model_altman <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y<span class="sc">~</span> wcap_at <span class="sc">+</span> re_act <span class="sc">+</span> r24 <span class="sc">+</span> mktval_altt <span class="sc">+</span> sale_at, <span class="at">data =</span> data_altman, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_altman)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Y ~ wcap_at + re_act + r24 + mktval_altt + sale_at, 
    family = "binomial", data = data_altman)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -2.537e+00  1.472e-01 -17.227  &lt; 2e-16 ***
wcap_at     -3.162e+00  3.798e-01  -8.326  &lt; 2e-16 ***
re_act      -7.701e-02  2.460e-02  -3.131 0.001742 ** 
r24         -3.232e+00  4.844e-01  -6.673 2.51e-11 ***
mktval_altt  1.510e-06  7.327e-06   0.206 0.836724    
sale_at      3.691e-01  9.785e-02   3.772 0.000162 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1627.3  on 3679  degrees of freedom
Residual deviance: 1458.6  on 3674  degrees of freedom
AIC: 1470.6

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(model_altman_1)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The equivalent <span class="math inline">\(x_3\)</span> parameter in my model would be the variable <span class="math inline">\(r24\)</span>, in the simple logistic regression above we see that the <span class="math inline">\(r24\)</span> coefficient is negative and significant to the 5% level (with a p-value of $ 2.51 * exp(-11)$ , so close to <span class="math inline">\(0\)</span> ), so if <span class="math inline">\(r24\)</span> increases, i.e.&nbsp;EBIT / Total Assets increases, our probability of default in the next period goes down. more specifically, by <span class="math inline">\(exp(-3.232)\)</span> 0.04.</p>
<p>r24 is significant to the 5% level, as p-value is close to 0.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we can also get the p-value directly from the model / table</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_altman)<span class="sc">$</span>coefficients[<span class="dv">4</span>,<span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.511994e-11</code></pre>
</div>
</div>
<p>confidence interval for r24 is: -4.181898 -2.282970.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>( <span class="st">'for r24:'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "for r24:"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint.default</span>(model_altman)[<span class="dv">4</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    2.5 %    97.5 % 
-4.181898 -2.282970 </code></pre>
</div>
</div>
</section>
<section id="exercise-5-financial-items-lasso" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="exercise-5-financial-items-lasso"><span class="header-section-number">1.4</span> Exercise 5: Financial items / Lasso</h2>
<p>Creating the Dataframe:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>undesired_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">"r"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">37</span>))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>existing_columns <span class="ot">&lt;-</span> <span class="fu">intersect</span>(undesired_columns, <span class="fu">colnames</span>(data_fin_exam))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>df_Lasso <span class="ot">&lt;-</span> data_fin_exam[, <span class="sc">!</span>(<span class="fu">colnames</span>(data_fin_exam) <span class="sc">%in%</span> existing_columns)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>– providing descriptive statistics,– showing correlated features,– showing/plotting individual features “interaction” with the response variable</p>
<p>Below for our variables</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>vars_quanti <span class="ot">&lt;-</span> <span class="fu">names</span>(df_Lasso <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.numeric))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(var <span class="cf">in</span> vars_quanti){</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    var <span class="ot">&lt;-</span> <span class="fu">as.name</span>(var)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">ggplot</span>(df_Lasso <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># filter(r17 &lt;0.14) %&gt;% </span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.numeric</span>(Y)<span class="sc">-</span><span class="dv">1</span>), <span class="fu">aes</span>(<span class="at">x=</span><span class="sc">!!</span> var,<span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_jitter</span>(<span class="at">height =</span> <span class="fl">0.1</span>, <span class="at">width =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>, </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">formula =</span> y <span class="sc">~</span> x,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"binomial"</span>), </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col =</span> <span class="st">"dodgerblue"</span>))</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-15.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-16.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-17.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-18.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-19.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-20.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-21.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-22.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-23-23.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(df_Lasso <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>Y), <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">#view(cor_matrix)</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># go through the matrix, printing variables that have a correlation with another on of higher than 90%, note: used CHATGPT for this</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="fl">0.9</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the dimensions of the correlation matrix</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">ncol</span>(cor_matrix)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through the matrix and print pairs with correlation higher than 90%</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n<span class="dv">-1</span>)) {</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> (i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n) {</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">abs</span>(cor_matrix[i, j]) <span class="sc">&gt;</span> threshold) {</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"Variables"</span>, <span class="fu">colnames</span>(cor_matrix)[i], <span class="st">"and"</span>, <span class="fu">colnames</span>(cor_matrix)[j], </span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>          <span class="st">"have a correlation of"</span>, cor_matrix[i, j], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Variables capx and ppent have a correlation of 0.9716096 
Variables capx and seq have a correlation of 0.9012668 
Variables cogs and sale have a correlation of 0.9688117 
Variables dp and ebitda have a correlation of 0.9357067 
Variables dp and at have a correlation of 0.9375303 
Variables act and lct have a correlation of 0.9580325 
Variables act and at have a correlation of 0.9044135 
Variables act and lt have a correlation of 0.9316767 
Variables act and rect have a correlation of 0.9323893 
Variables lct and at have a correlation of 0.9131745 
Variables lct and lt have a correlation of 0.948796 
Variables ebit and ebitda have a correlation of 0.9821573 
Variables ebit and gp have a correlation of 0.9397232 
Variables ebit and ib have a correlation of 0.9634145 
Variables ebit and ni have a correlation of 0.9609136 
Variables ebit and seq have a correlation of 0.9007075 
Variables ebitda and gp have a correlation of 0.9525888 
Variables ebitda and ib have a correlation of 0.9365907 
Variables ebitda and ni have a correlation of 0.9343453 
Variables ebitda and seq have a correlation of 0.919892 
Variables ebitda and at have a correlation of 0.9360263 
Variables re and seq have a correlation of 0.9056644 
Variables gp and at have a correlation of 0.911858 
Variables ib and ni have a correlation of 0.9979269 
Variables xint and dltt have a correlation of 0.9300732 
Variables dltt and lt have a correlation of 0.9267418 
Variables seq and at have a correlation of 0.9139955 
Variables at and lt have a correlation of 0.9521162 </code></pre>
</div>
</div>
<p>removing correlated variables</p>
<p>Based on the financial point of view and linear combinations, you can remove:</p>
<p>Depreciation (dp) (captured in EBITDA). EBIT (captured in EBITDA). Gross Profit (gp) (redundant when using Net Income). Income Before Extraordinary Items (ib) (captured by Net Income). Long-Term Debt (dltt) (captured by Total Liabilities (lt)). Working Capital (wcap) (can be derived from Current Assets (act) and Current Liabilities (lct)). Receivables (rect) and Inventories (invt) (captured within Current Assets (act) if a more granular view is not needed).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df_Lasso <span class="ot">&lt;-</span> df_Lasso <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>dp, <span class="sc">-</span>ebit, <span class="sc">-</span>gp, <span class="sc">-</span>ib, <span class="sc">-</span>dltt, <span class="sc">-</span>wcap, <span class="sc">-</span>rect, <span class="sc">-</span>invt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>2nd run:</p>
<ul>
<li><p><strong>Capx</strong> (since it is highly correlated with <strong>ppent</strong>).</p></li>
<li><p><strong>Lt</strong> (since <strong>at</strong> provides a broader picture).</p></li>
<li><p><strong>Lct</strong> (or combine it with <strong>act</strong> into a ratio).</p></li>
<li><p><strong>Cogs</strong> (since <strong>sale</strong> gives a more comprehensive view).</p></li>
<li><p><strong>Re</strong> (since <strong>seq</strong> gives a broader financial view).</p></li>
<li><p><strong>Ni</strong> (since <strong>ebitda</strong> is more operationally focused).</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df_Lasso <span class="ot">&lt;-</span> df_Lasso <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>capx, <span class="sc">-</span>lt, <span class="sc">-</span>lct, <span class="sc">-</span>cogs, <span class="sc">-</span>re, <span class="sc">-</span>ni)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>box-plots and winsorization:</p>
<p>We decide to winsorise the data for the lasso as we observe quite a few outliers and so should have better data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ensure data is numeric</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # repeating the code for box-plots but with the winsorzed data</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># df_Lasso_winsorised &lt;- df_Lasso %&gt;% </span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(-Y) %&gt;%</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(across(everything(), as.numeric)) %&gt;%</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(across(everything(), ~ DescTools::Winsorize(.x, quantile(probs = c(0.025, 0.975)))))</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # Add back the 'Y' column if needed</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># df_Lasso_winsorised &lt;- bind_cols(df_Lasso_winsorised, Y = df_Lasso$Y)</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co"># # View the winsorized data</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co"># head(df_Lasso_winsorised)</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co"># I can~t seem to make the code work at this moment, correct</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># df_Lasso_numeric &lt;- df_Lasso_winsorised %&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(across(everything(), as.numeric))</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # Reshape the data from wide to long format</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># df_long &lt;- df_Lasso_numeric %&gt;%</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_longer(cols = everything(), names_to = "Variable", values_to = "Value")</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plot the boxplots</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(df_long, aes(x = Variable, y = Value)) +</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_boxplot() +</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 90, hjust = 1)) + # Rotate x-axis labels for readability</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Variables", y = "Values", title = "Boxplots of Variables in df_Lasso")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#full_model_items</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>full_model_items <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y<span class="sc">~</span>., <span class="at">data =</span> df_Lasso, <span class="at">family=</span><span class="fu">binomial</span>())</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_model_items)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Y ~ ., family = binomial(), data = df_Lasso)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -2.605e+00  8.191e-02 -31.805  &lt; 2e-16 ***
che         -3.133e-03  1.017e-03  -3.080 0.002067 ** 
act         -1.130e-03  3.495e-04  -3.231 0.001232 ** 
ebitda      -9.796e-03  1.290e-03  -7.596 3.05e-14 ***
xint         2.068e-02  4.243e-03   4.874 1.09e-06 ***
ppent        2.675e-04  2.467e-04   1.084 0.278224    
sale         5.492e-04  5.998e-05   9.157  &lt; 2e-16 ***
seq         -3.074e-03  4.385e-04  -7.011 2.36e-12 ***
at           1.220e-03  3.255e-04   3.748 0.000178 ***
mktval      -1.534e-03  3.119e-04  -4.918 8.74e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1765.5  on 4352  degrees of freedom
Residual deviance: 1393.5  on 4343  degrees of freedom
AIC: 1413.5

Number of Fisher Scoring iterations: 12</code></pre>
</div>
</div>
<p>Thenusingfunction glmnet::cv.glmnet or more conveniently glmnetUtils::cv.glmnet as shown in lesson 2 (for example in the cross-validation function defined at the end of the lesson): select a “best value” for the lasso parameter “lambda” giving a penalized model lasso_model_items.</p>
<p>Then using the function glmnet::cv.glmnet or more conveniently glmnetUtils::cv.glmnet as shown in lesson 2 (for example in the cross-validation function defined at the end of the lesson): select a “best value” for the lasso parameter “lambda” giving a penalized model lasso_model_items.</p>
<p>This is due the the lasso specification adding the penalisation term to the MSE formula, thus we increase the MSE when increasing the number of varaibles we use in out model, when <span class="math inline">\(\lambda \neq 0\)</span>. Thus, as we are minimising <span class="math inline">\(MSE\)</span> we will shrink the parameters as our penalisation parameter <span class="math inline">\(\lambda\)</span> grows, reducing overfitting.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> df_Lasso <span class="sc">%&gt;%</span> <span class="fu">pull</span>(Y)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>lasso_model_items <span class="ot">&lt;-</span> glmnetUtils<span class="sc">::</span><span class="fu">glmnet</span>(Y <span class="sc">~</span> ., <span class="at">data=</span>df_Lasso, <span class="at">family=</span><span class="st">"binomial"</span>, <span class="at">alpha=</span><span class="dv">1</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lasso_model_items)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>we have to choose a lambda parameter to then create our model. For this we use the automatic selection provided by glmnet, it will calculate the MSE of all models and look at the optimal MSE and <span class="math inline">\(\lambda\)</span> combination. Giving us the following model / coefficient and variable combination below.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>lasso_model_items_cv <span class="ot">&lt;-</span> glmnetUtils<span class="sc">::</span><span class="fu">cv.glmnet</span>(Y <span class="sc">~</span> ., <span class="at">data=</span>df_Lasso, <span class="at">family=</span><span class="st">"binomial"</span>, <span class="at">alpha=</span><span class="dv">1</span>, <span class="at">type.measure =</span> <span class="st">"auc"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted probs will be run below in the ROC and AUC section</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">#checking coefficients</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>lasso_model_items_coef <span class="ot">&lt;-</span> <span class="fu">coef</span>(lasso_model_items_cv, <span class="at">s =</span> <span class="st">"lambda.1se"</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">name =</span>lasso_model_items_coef<span class="sc">@</span>Dimnames[[<span class="dv">1</span>]][lasso_model_items_coef<span class="sc">@</span>i <span class="sc">+</span> <span class="dv">1</span>], <span class="at">coefficient =</span> lasso_model_items_coef<span class="sc">@</span>x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["coefficient"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"-2.905382e+00"},{"1":"xint","2":"1.832814e-04"},{"1":"mktval","2":"-7.389577e-06"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="exercise-6-model-assessment" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="exercise-6-model-assessment"><span class="header-section-number">1.5</span> Exercise 6: Model Assessment</h2>
<p>we load the test data</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>data_fin_holdout <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">'C:/Users/Alex/Documents/GitHub/Scoring_Alex/teaching_Scoring/exam/data/data_fin_holdout.rds'</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">glimpse</span>(data_fin_holdout)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 461
Columns: 44
$ Y      &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ capx   &lt;dbl&gt; 960.000, 68.097, 882.000, 94.900, 598.000, 681.000, 2928.000, 3…
$ che    &lt;dbl&gt; 1236.000, 25.539, 5926.000, 532.700, 1806.000, 1832.000, 7388.0…
$ cogs   &lt;dbl&gt; 6193.000, 377.460, 57762.000, 2164.800, 9203.000, 5521.000, 261…
$ dp     &lt;dbl&gt; 398.000, 55.714, 900.000, 102.500, 678.000, 773.000, 3033.000, …
$ act    &lt;dbl&gt; 1787.000, 199.987, 21045.000, 1762.000, 4884.000, 5919.000, 319…
$ lct    &lt;dbl&gt; 2942.000, 75.301, 13173.000, 1496.500, 5577.000, 2836.000, 2613…
$ ebit   &lt;dbl&gt; 775.000, 46.263, 1663.000, 246.600, 1176.000, 1767.000, 2750.00…
$ ebitda &lt;dbl&gt; 1173.000, 101.977, 2563.000, 349.100, 1854.000, 2540.000, 5783.…
$ re     &lt;dbl&gt; 4086.000, 685.476, 14846.000, 1203.900, 4893.000, 11202.000, 25…
$ gp     &lt;dbl&gt; 2071.000, 130.741, 4584.000, 3238.100, 2271.000, 5606.000, 1242…
$ ib     &lt;dbl&gt; 437.000, 50.943, 1279.000, -19.500, 566.000, 1630.000, -67.000,…
$ xint   &lt;dbl&gt; 91.000, 18.871, 313.000, 134.600, 317.000, 105.000, 1108.000, 2…
$ dltt   &lt;dbl&gt; 1617.000, 258.458, 6504.000, 1581.600, 6518.000, 3473.000, 2281…
$ ni     &lt;dbl&gt; 437.000, 50.943, 1279.000, -19.500, 566.000, 1624.000, -67.000,…
$ ppent  &lt;dbl&gt; 6781.000, 726.251, 9758.000, 570.200, 4709.000, 4542.000, 15322…
$ sale   &lt;dbl&gt; 8264.000, 508.201, 62346.000, 5402.900, 11474.000, 11127.000, 3…
$ seq    &lt;dbl&gt; 3751.000, 702.555, 17173.000, -412.400, 2949.000, 7794.000, 131…
$ at     &lt;dbl&gt; 10912.000, 1111.893, 39769.000, 3010.000, 17360.000, 15641.000,…
$ lt     &lt;dbl&gt; 7161.000, 409.338, 22564.000, 3414.700, 14341.000, 7825.000, 61…
$ invt   &lt;dbl&gt; 60.000, 8.187, 8831.000, 542.000, 1274.000, 1653.000, 8614.000,…
$ rect   &lt;dbl&gt; 366.000, 160.289, 4405.000, 418.900, 1631.000, 1812.000, 14503.…
$ wcap   &lt;dbl&gt; -1155.000, 124.686, 7872.000, 265.500, -693.000, 3083.000, 5835…
$ mktval &lt;dbl&gt; 7496.35490, 487.19096, 26157.45000, 672.44800, 20994.14545, 337…
$ r1     &lt;dbl&gt; 0.6562500, 0.3681451, 0.5673766, 1.1344518, 0.8260945, 0.500287…
$ r2     &lt;dbl&gt; 0.6987705, 0.7310567, 0.7243241, -0.3504121, 0.3092167, 0.69040…
$ r3     &lt;dbl&gt; 0.41083648, 0.18395800, 0.58380606, 0.43825226, 0.38888501, 0.3…
$ r4     &lt;dbl&gt; 0.26961144, 0.06772324, 0.33123790, 0.49717608, 0.32125576, 0.1…
$ r5     &lt;dbl&gt; 0.38663856, 0.30042189, 0.23613870, 0.63727575, 0.50483871, 0.3…
$ r6     &lt;dbl&gt; 3.4577499, 3.1309077, 4.9223386, 1.0545382, 6.3148393, 1.395825…
$ r7     &lt;dbl&gt; 2.03718011, 2.55495216, 2.04864747, 0.59238442, 3.85909291, 0.8…
$ r8     &lt;dbl&gt; 1.4205698, 0.5759555, 2.8736911, 0.4621537, 2.4557464, 0.505886…
$ r11    &lt;dbl&gt; -0.55770159, 0.95368706, 1.71727749, 0.08199253, -0.30515192, 0…
$ r12    &lt;dbl&gt; -0.16500000, 0.32189243, 0.13236926, 0.05397219, -0.07449210, 0…
$ r14    &lt;dbl&gt; 1.6463346, 0.3765295, 0.6259444, 0.8493190, 1.1418919, 0.479135…
$ r17    &lt;dbl&gt; 0.012707722, 0.046101266, 0.013871654, 0.039417811, 0.022104456…
$ r18    &lt;dbl&gt; 0.043940126, 0.144338807, 0.068280977, 0.041567586, 0.139586085…
$ r21    &lt;dbl&gt; 0.07757886, 0.18505153, 0.12212251, 0.38556288, 0.17098166, 0.0…
$ r24    &lt;dbl&gt; 0.10749633, 0.09171476, 0.06444718, 0.11598007, 0.10679724, 0.1…
$ r28    &lt;dbl&gt; 0.5663930, 0.7799925, 0.5591187, 0.1078101, 0.8163804, 0.453086…
$ r30    &lt;dbl&gt; 0.211009174, 0.389648236, 0.279013962, -0.006022050, 0.24922941…
$ r32    &lt;dbl&gt; 0.52245292, 0.63565370, 0.49083770, 0.06624255, 0.67679436, 0.4…
$ r36    &lt;dbl&gt; 4.4060840, 6.9749046, 4.0846422, 0.3854112, 5.4936151, 1.734213…
$ r37    &lt;dbl&gt; 0.1897911, 0.1175842, 0.1152657, 1.0757807, 0.1308180, 0.358417…</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#creating the altman predictors:</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>data_fin_holdout <span class="ot">&lt;-</span> data_fin_holdout <span class="sc">|&gt;</span> <span class="fu">mutate</span>( <span class="at">re_act =</span> re <span class="sc">/</span> act)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># sales / total assets: sale_at = sale / at</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>data_fin_holdout <span class="ot">&lt;-</span> data_fin_holdout <span class="sc">|&gt;</span> <span class="fu">mutate</span>( <span class="at">sale_at =</span> sale <span class="sc">/</span> at)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co">#working capital / total assets</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>data_fin_holdout <span class="ot">&lt;-</span> data_fin_holdout <span class="sc">|&gt;</span> <span class="fu">mutate</span>( <span class="at">wcap_at =</span> wcap <span class="sc">/</span> at)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># marketval of equity / book value of debt</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>data_fin_holdout <span class="ot">&lt;-</span> data_fin_holdout <span class="sc">|&gt;</span> <span class="fu">mutate</span>( <span class="at">mktval_altt =</span> mktval <span class="sc">/</span> dltt, <span class="at">mktval_altt =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(mktval_altt), <span class="cn">NA</span>, mktval_altt))</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co"># removing nas</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>data_fin_holdout <span class="ot">&lt;-</span> data_fin_holdout <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(mktval_altt))</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_fin_holdout)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Y"],"name":[1],"type":["fct"],"align":["left"]},{"label":["capx"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["che"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["cogs"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["dp"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["act"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["lct"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["ebit"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["ebitda"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["re"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["gp"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["ib"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["xint"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["dltt"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["ni"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["ppent"],"name":[16],"type":["dbl"],"align":["right"]},{"label":["sale"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["seq"],"name":[18],"type":["dbl"],"align":["right"]},{"label":["at"],"name":[19],"type":["dbl"],"align":["right"]},{"label":["lt"],"name":[20],"type":["dbl"],"align":["right"]},{"label":["invt"],"name":[21],"type":["dbl"],"align":["right"]},{"label":["rect"],"name":[22],"type":["dbl"],"align":["right"]},{"label":["wcap"],"name":[23],"type":["dbl"],"align":["right"]},{"label":["mktval"],"name":[24],"type":["dbl"],"align":["right"]},{"label":["r1"],"name":[25],"type":["dbl"],"align":["right"]},{"label":["r2"],"name":[26],"type":["dbl"],"align":["right"]},{"label":["r3"],"name":[27],"type":["dbl"],"align":["right"]},{"label":["r4"],"name":[28],"type":["dbl"],"align":["right"]},{"label":["r5"],"name":[29],"type":["dbl"],"align":["right"]},{"label":["r6"],"name":[30],"type":["dbl"],"align":["right"]},{"label":["r7"],"name":[31],"type":["dbl"],"align":["right"]},{"label":["r8"],"name":[32],"type":["dbl"],"align":["right"]},{"label":["r11"],"name":[33],"type":["dbl"],"align":["right"]},{"label":["r12"],"name":[34],"type":["dbl"],"align":["right"]},{"label":["r14"],"name":[35],"type":["dbl"],"align":["right"]},{"label":["r17"],"name":[36],"type":["dbl"],"align":["right"]},{"label":["r18"],"name":[37],"type":["dbl"],"align":["right"]},{"label":["r21"],"name":[38],"type":["dbl"],"align":["right"]},{"label":["r24"],"name":[39],"type":["dbl"],"align":["right"]},{"label":["r28"],"name":[40],"type":["dbl"],"align":["right"]},{"label":["r30"],"name":[41],"type":["dbl"],"align":["right"]},{"label":["r32"],"name":[42],"type":["dbl"],"align":["right"]},{"label":["r36"],"name":[43],"type":["dbl"],"align":["right"]},{"label":["r37"],"name":[44],"type":["dbl"],"align":["right"]},{"label":["re_act"],"name":[45],"type":["dbl"],"align":["right"]},{"label":["sale_at"],"name":[46],"type":["dbl"],"align":["right"]},{"label":["wcap_at"],"name":[47],"type":["dbl"],"align":["right"]},{"label":["mktval_altt"],"name":[48],"type":["dbl"],"align":["right"]}],"data":[{"1":"0","2":"960.000","3":"1236.000","4":"6193.00","5":"398.000","6":"1787.000","7":"2942.000","8":"775.000","9":"1173.000","10":"4086.000","11":"2071.000","12":"437.000","13":"91.000","14":"1617.000","15":"437.000","16":"6781.000","17":"8264.000","18":"3751.000","19":"10912.000","20":"7161.000","21":"60.000","22":"366.000","23":"-1155.000","24":"7496.355","25":"0.6562500","26":"0.6987705","27":"0.4108365","28":"0.26961144","29":"0.3866386","30":"3.457750","31":"2.0371801","32":"1.4205698","33":"-0.55770159","34":"-0.16500000","35":"1.6463346","36":"0.01270772","37":"0.04394013","38":"0.07757886","39":"0.10749633","40":"0.5663930","41":"0.21100917","42":"0.52245292","43":"4.4060840","44":"0.1897911","45":"2.2865137","46":"0.7573314","47":"-0.10584677","48":"4.6359647"},{"1":"0","2":"68.097","3":"25.539","4":"377.46","5":"55.714","6":"199.987","7":"75.301","8":"46.263","9":"101.977","10":"685.476","11":"130.741","12":"50.943","13":"18.871","14":"258.458","15":"50.943","16":"726.251","17":"508.201","18":"702.555","19":"1111.893","20":"409.338","21":"8.187","22":"160.289","23":"124.686","24":"487.191","25":"0.3681451","26":"0.7310567","27":"0.1839580","28":"0.06772324","29":"0.3004219","30":"3.130908","31":"2.5549522","32":"0.5759555","33":"0.95368706","34":"0.32189243","35":"0.3765295","36":"0.04610127","37":"0.14433881","38":"0.18505153","39":"0.09171476","40":"0.7799925","41":"0.38964824","42":"0.63565370","43":"6.9749046","44":"0.1175842","45":"3.4276028","46":"0.4570593","47":"0.11213849","48":"1.8849908"},{"1":"0","2":"882.000","3":"5926.000","4":"57762.00","5":"900.000","6":"21045.000","7":"13173.000","8":"1663.000","9":"2563.000","10":"14846.000","11":"4584.000","12":"1279.000","13":"313.000","14":"6504.000","15":"1279.000","16":"9758.000","17":"62346.000","18":"17173.000","19":"39769.000","20":"22564.000","21":"8831.000","22":"4405.000","23":"7872.000","24":"26157.450","25":"0.5673766","26":"0.7243241","27":"0.5838061","28":"0.33123790","29":"0.2361387","30":"4.922339","31":"2.0486475","32":"2.8736911","33":"1.71727749","34":"0.13236926","35":"0.6259444","36":"0.01387165","37":"0.06828098","38":"0.12212251","39":"0.06444718","40":"0.5591187","41":"0.27901396","42":"0.49083770","43":"4.0846422","44":"0.1152657","45":"0.7054407","46":"1.5677035","47":"0.19794312","48":"4.0217482"},{"1":"0","2":"94.900","3":"532.700","4":"2164.80","5":"102.500","6":"1762.000","7":"1496.500","8":"246.600","9":"349.100","10":"1203.900","11":"3238.100","12":"-19.500","13":"134.600","14":"1581.600","15":"-19.500","16":"570.200","17":"5402.900","18":"-412.400","19":"3010.000","20":"3414.700","21":"542.000","22":"418.900","23":"265.500","24":"672.448","25":"1.1344518","26":"-0.3504121","27":"0.4382523","28":"0.49717608","29":"0.6372757","30":"1.054538","31":"0.5923844","32":"0.4621537","33":"0.08199253","34":"0.05397219","35":"0.8493190","36":"0.03941781","37":"0.04156759","38":"0.38556288","39":"0.11598007","40":"0.1078101","41":"-0.00602205","42":"0.06624255","43":"0.3854112","44":"1.0757807","45":"0.6832577","46":"1.7949834","47":"0.08820598","48":"0.4251694"},{"1":"0","2":"598.000","3":"1806.000","4":"9203.00","5":"678.000","6":"4884.000","7":"5577.000","8":"1176.000","9":"1854.000","10":"4893.000","11":"2271.000","12":"566.000","13":"317.000","14":"6518.000","15":"566.000","16":"4709.000","17":"11474.000","18":"2949.000","19":"17360.000","20":"14341.000","21":"1274.000","22":"1631.000","23":"-693.000","24":"20994.145","25":"0.8260945","26":"0.3092167","27":"0.3888850","28":"0.32125576","29":"0.5048387","30":"6.314839","31":"3.8590929","32":"2.4557464","33":"-0.30515192","34":"-0.07449210","35":"1.1418919","36":"0.02210446","37":"0.13958609","38":"0.17098166","39":"0.10679724","40":"0.8163804","41":"0.24922941","42":"0.67679436","43":"5.4936151","44":"0.1308180","45":"1.0018428","46":"0.6609447","47":"-0.03991935","48":"3.2209490"},{"1":"0","2":"681.000","3":"1832.000","4":"5521.00","5":"773.000","6":"5919.000","7":"2836.000","8":"1767.000","9":"2540.000","10":"11202.000","11":"5606.000","12":"1630.000","13":"105.000","14":"3473.000","15":"1624.000","16":"4542.000","17":"11127.000","18":"7794.000","19":"15641.000","20":"7825.000","21":"1653.000","22":"1812.000","23":"3083.000","24":"33765.594","25":"0.5002877","26":"0.6904066","27":"0.3624281","28":"0.18131833","29":"0.3189694","30":"1.395826","31":"0.8899394","32":"0.5058866","33":"0.54994649","34":"0.36347560","35":"0.4791350","36":"0.01341853","37":"0.01872993","38":"0.04133858","39":"0.16239371","40":"0.4530860","41":"0.28968962","42":"0.43435605","43":"1.7342133","44":"0.3584170","45":"1.8925494","46":"0.7113995","47":"0.19711016","48":"9.7223133"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Then plot the ROC Curves and compare the AUC of full_model_desbois, step wise_model_desbois, model_altman, full_model_items, lasso_model_items</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plotting the ROC curves</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC Curves with ROCR</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ROCR"</span>)    </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co">#we can take Y values from any dataset as they are the same over the datasets</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co"># full_model_desbois</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>full_model_desbois_predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(full_model_desbois, <span class="at">newdata=</span>data_fin_holdout, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(full_model_desbois_predict, data_fin_holdout<span class="sc">$</span>Y)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="co"># pred &lt;- prediction(full_model_desbois, data_trimmed$Y)</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"tpr"</span>, <span class="at">x.measure =</span> <span class="st">"fpr"</span>)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf, <span class="at">main=</span><span class="st">"ROC curve Admissions"</span>, <span class="at">xlab=</span><span class="st">"Specificity"</span>,</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Sensitivity"</span>, <span class="at">col =</span> <span class="st">"darkorange"</span>)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="co">#add a 45 degree line</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>full_model_desbois_auc <span class="ot">&lt;-</span> ROCR<span class="sc">::</span><span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"auc"</span>)</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>full_model_desbois_auc <span class="ot">&lt;-</span> full_model_desbois_auc<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a><span class="co"># stepwise_model_desbois,</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>stepwise_model_desbois_predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(stepwise_model_desbois, <span class="at">newdata=</span>data_fin_holdout, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(stepwise_model_desbois_predict, data_fin_holdout<span class="sc">$</span>Y)</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"tpr"</span>, <span class="at">x.measure =</span> <span class="st">"fpr"</span>)</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">main=</span><span class="st">"ROC curve Admissions"</span>, <span class="at">xlab=</span><span class="st">"Specificity"</span>, <span class="at">ylab=</span><span class="st">"Sensitivity"</span>, <span class="at">col =</span> <span class="st">"darkolivegreen"</span>)</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a><span class="co"># stepwise_model_desbois_predict &lt;- ROCR::prediction(stepwise_model_desbois$fitted.values, data_fin_holdout$Y)</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>stepwise_model_desbois_auc <span class="ot">&lt;-</span> ROCR<span class="sc">::</span><span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"auc"</span>)</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>stepwise_model_desbois_auc <span class="ot">&lt;-</span> stepwise_model_desbois_auc<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a><span class="co"># model_altman</span></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>model_altman_predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_altman, <span class="at">newdata=</span>data_fin_holdout, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(model_altman_predict, data_fin_holdout<span class="sc">$</span>Y)</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"tpr"</span>, <span class="at">x.measure =</span> <span class="st">"fpr"</span>)</span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">main=</span><span class="st">"ROC curve Admissions"</span>, <span class="at">xlab=</span><span class="st">"Specificity"</span>, <span class="at">ylab=</span><span class="st">"Sensitivity"</span>, <span class="at">col =</span> <span class="st">"plum4"</span>)</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a><span class="co"># model_altman_predict &lt;- ROCR::prediction(model_altman$fitted.values, data_fin_holdout$Y)</span></span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>model_altman_auc <span class="ot">&lt;-</span> ROCR<span class="sc">::</span><span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"auc"</span>)</span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>model_altman_auc <span class="ot">&lt;-</span> model_altman_auc<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a><span class="co"># full_model_items</span></span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a>full_model_items_predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(full_model_items, <span class="at">newdata=</span>data_fin_holdout, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(full_model_items_predict, data_fin_holdout<span class="sc">$</span>Y)</span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"tpr"</span>, <span class="at">x.measure =</span> <span class="st">"fpr"</span>)</span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">main=</span><span class="st">"ROC curve Admissions"</span>, <span class="at">xlab=</span><span class="st">"Specificity"</span>, <span class="at">ylab=</span><span class="st">"Sensitivity"</span>, <span class="at">col =</span> <span class="st">"darkblue"</span>)</span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a>full_model_items_auc <span class="ot">&lt;-</span> ROCR<span class="sc">::</span><span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"auc"</span>)</span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a>full_model_items_auc <span class="ot">&lt;-</span> full_model_items_auc<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a><span class="co"># lasso_model_items</span></span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true" tabindex="-1"></a>full_model_items_predict <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">predict</span>(lasso_model_items_cv, <span class="at">newdata =</span> data_fin_holdout, <span class="at">s =</span> lasso_model_items_cv<span class="sc">$</span>lambda<span class="fl">.1</span>se, <span class="at">type =</span> <span class="st">"response"</span>))</span>
<span id="cb51-52"><a href="#cb51-52" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(full_model_items_predict, data_fin_holdout<span class="sc">$</span>Y)</span>
<span id="cb51-53"><a href="#cb51-53" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"tpr"</span>, <span class="at">x.measure =</span> <span class="st">"fpr"</span>)</span>
<span id="cb51-54"><a href="#cb51-54" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">main=</span><span class="st">"ROC curve Admissions"</span>, <span class="at">xlab=</span><span class="st">"Specificity"</span>, <span class="at">ylab=</span><span class="st">"Sensitivity"</span>, <span class="at">col =</span> <span class="st">"dodgerblue"</span>)</span>
<span id="cb51-55"><a href="#cb51-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-56"><a href="#cb51-56" aria-hidden="true" tabindex="-1"></a><span class="co"># lasso_model_items_predict &lt;- ROCR::prediction(lasso_model_items$fitted.values, df_Lasso$Y)</span></span>
<span id="cb51-57"><a href="#cb51-57" aria-hidden="true" tabindex="-1"></a>lasso_model_items_auc <span class="ot">&lt;-</span> ROCR<span class="sc">::</span><span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"auc"</span>)</span>
<span id="cb51-58"><a href="#cb51-58" aria-hidden="true" tabindex="-1"></a>lasso_model_items_auc <span class="ot">&lt;-</span> lasso_model_items_auc<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb51-59"><a href="#cb51-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-60"><a href="#cb51-60" aria-hidden="true" tabindex="-1"></a><span class="co">#plot</span></span>
<span id="cb51-61"><a href="#cb51-61" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="fl">0.6</span>,<span class="fl">0.6</span>,</span>
<span id="cb51-62"><a href="#cb51-62" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">'full_model_desbois'</span>, <span class="st">'stepwise_model_desbois'</span>, <span class="st">'model_altman'</span>, <span class="st">'full_model_items'</span>, <span class="st">'lasso_model_items'</span>),</span>
<span id="cb51-63"><a href="#cb51-63" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">"darkorange"</span>, <span class="st">"darkolivegreen"</span>, <span class="st">"plum4"</span>, <span class="st">"darkblue"</span>, <span class="st">"dodgerblue"</span>),<span class="at">lwd=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#AUC measures</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>auc_table <span class="ot">&lt;-</span> <span class="fu">table</span>(full_model_desbois_auc, stepwise_model_desbois_auc, model_altman_auc, full_model_items_auc, lasso_model_items_auc)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(auc_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>, , model_altman_auc = 0.709031501340483, full_model_items_auc = 0.854138739946383, lasso_model_items_auc = 0.933394772117962

                      stepwise_model_desbois_auc
full_model_desbois_auc 0.847436327077748
     0.853887399463806                 1</code></pre>
</div>
</div>
<p>In our case, the lasso model is the best with AUC of 0.932389410187667</p>
</section>
<section id="exercise-7-decision-boundary-and-data-simulation" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="exercise-7-decision-boundary-and-data-simulation"><span class="header-section-number">1.6</span> Exercise 7: Decision boundary and data simulation</h2>
<p>Simulate a training test of 200 observations (100 for each Class 0/1)</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#library()</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Simulation:</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 1 parameters</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>pi_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>mu_11 <span class="ot">&lt;-</span> <span class="dv">4</span> </span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>mu_12 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>sig_11 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">2</span>)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>sig_12 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>rho_1 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0 parameters , choosen randomly with prob 1/2 of 2 buckets</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>pi_0 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> pi_1</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>pi_0a <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>pi_0b <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>mu_01a <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>mu_02a <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>mu_01b <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>mu_02b <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">4</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>sig_01 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">2</span>)</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>sig_02 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">2</span>)</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>rho_0 <span class="ot">&lt;-</span> <span class="dv">0</span> </span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 1 helpers</span></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>mu_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(mu_11, mu_12)</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>Sigma_1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_11 <span class="sc">^</span> <span class="dv">2</span>, rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, sig_12 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>det_Sigma_1 <span class="ot">&lt;-</span> sig_11 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> sig_12 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> rho_1 <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>inv_Sigma_1 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> det_Sigma_1 <span class="sc">*</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_12 <span class="sc">^</span> <span class="dv">2</span>, <span class="sc">-</span> rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, <span class="sc">-</span> rho_1 <span class="sc">*</span> sig_11 <span class="sc">*</span> sig_12, sig_11 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0a helpers</span></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>mu_0a <span class="ot">&lt;-</span> <span class="fu">c</span>(mu_01a, mu_02a)</span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>Sigma_0 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_01 <span class="sc">^</span> <span class="dv">2</span>, rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, sig_02 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a>det_Sigma_0  <span class="ot">&lt;-</span> sig_01 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> sig_02 <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> rho_0 <span class="sc">^</span> <span class="dv">2</span>) </span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>inv_Sigma_0 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> det_Sigma_0 <span class="sc">*</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sig_02 <span class="sc">^</span> <span class="dv">2</span>, <span class="sc">-</span> rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, <span class="sc">-</span> rho_0 <span class="sc">*</span> sig_01 <span class="sc">*</span> sig_02, sig_01 <span class="sc">^</span> <span class="dv">2</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0b helpers</span></span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a>mu_0b <span class="ot">&lt;-</span> <span class="fu">c</span>(mu_01b, mu_02b)</span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="at">len =</span> <span class="dv">600</span>)</span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>, <span class="at">len =</span> <span class="dv">600</span>)</span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Sampling n data from the given distrib</span></span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">6</span>)</span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a><span class="co">#n1 &lt;- rbinom(1, n, pi_1)</span></span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a>n0 <span class="ot">&lt;-</span> n <span class="sc">-</span> n1 <span class="co">#will be 100 too</span></span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a><span class="co"># getting dist of 0a and 0b</span></span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a>n0a <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n0, pi_0a)</span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a>n0b <span class="ot">&lt;-</span> n0 <span class="sc">-</span> n0a</span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 1</span></span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a>train_class_1 <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(n1, mu_1, Sigma_1)</span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a>train_class_1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Y=</span><span class="dv">1</span>, <span class="at">x1 =</span> train_class_1[,<span class="dv">1</span>], <span class="at">x2 =</span> train_class_1[,<span class="dv">2</span>])</span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0a</span></span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a>train_class_0a <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(n0a, mu_0a, Sigma_0)</span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a>train_class_0a <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Y=</span><span class="dv">0</span>, <span class="at">x1 =</span> train_class_0a[,<span class="dv">1</span>], <span class="at">x2 =</span> train_class_0a[,<span class="dv">2</span>])</span>
<span id="cb54-63"><a href="#cb54-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-64"><a href="#cb54-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0b</span></span>
<span id="cb54-65"><a href="#cb54-65" aria-hidden="true" tabindex="-1"></a>train_class_0b <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(n0b, mu_0b, Sigma_0)</span>
<span id="cb54-66"><a href="#cb54-66" aria-hidden="true" tabindex="-1"></a>train_class_0b <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Y=</span><span class="dv">0</span>, <span class="at">x1 =</span> train_class_0b[,<span class="dv">1</span>], <span class="at">x2 =</span> train_class_0b[,<span class="dv">2</span>])</span>
<span id="cb54-67"><a href="#cb54-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-68"><a href="#cb54-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeating for test</span></span>
<span id="cb54-69"><a href="#cb54-69" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb54-70"><a href="#cb54-70" aria-hidden="true" tabindex="-1"></a><span class="co">#n1 &lt;- rbinom(1, n, pi_1)</span></span>
<span id="cb54-71"><a href="#cb54-71" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb54-72"><a href="#cb54-72" aria-hidden="true" tabindex="-1"></a>n0 <span class="ot">&lt;-</span> n <span class="sc">-</span> n1 <span class="co">#will be 1000 too</span></span>
<span id="cb54-73"><a href="#cb54-73" aria-hidden="true" tabindex="-1"></a><span class="co"># getting dist of 0a and 0b</span></span>
<span id="cb54-74"><a href="#cb54-74" aria-hidden="true" tabindex="-1"></a>n0a <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1</span>, n0, pi_0a)</span>
<span id="cb54-75"><a href="#cb54-75" aria-hidden="true" tabindex="-1"></a>n0b <span class="ot">&lt;-</span> n0 <span class="sc">-</span> n0a</span>
<span id="cb54-76"><a href="#cb54-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-77"><a href="#cb54-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 1</span></span>
<span id="cb54-78"><a href="#cb54-78" aria-hidden="true" tabindex="-1"></a>test_class_1 <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(n1, mu_1, Sigma_1)</span>
<span id="cb54-79"><a href="#cb54-79" aria-hidden="true" tabindex="-1"></a>test_class_1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Y=</span><span class="dv">1</span>, <span class="at">x1 =</span> test_class_1[,<span class="dv">1</span>], <span class="at">x2 =</span> test_class_1[,<span class="dv">2</span>])</span>
<span id="cb54-80"><a href="#cb54-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-81"><a href="#cb54-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0a</span></span>
<span id="cb54-82"><a href="#cb54-82" aria-hidden="true" tabindex="-1"></a>test_class_0a <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(n0a, mu_0a, Sigma_0)</span>
<span id="cb54-83"><a href="#cb54-83" aria-hidden="true" tabindex="-1"></a>test_class_0a <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Y=</span><span class="dv">0</span>, <span class="at">x1 =</span> test_class_0a[,<span class="dv">1</span>], <span class="at">x2 =</span> test_class_0a[,<span class="dv">2</span>])</span>
<span id="cb54-84"><a href="#cb54-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-85"><a href="#cb54-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Class 0b</span></span>
<span id="cb54-86"><a href="#cb54-86" aria-hidden="true" tabindex="-1"></a>test_class_0b <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(n0b, mu_0b, Sigma_0)</span>
<span id="cb54-87"><a href="#cb54-87" aria-hidden="true" tabindex="-1"></a>test_class_0b <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Y=</span><span class="dv">0</span>, <span class="at">x1 =</span> test_class_0b[,<span class="dv">1</span>], <span class="at">x2 =</span> test_class_0b[,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="fit-a-logistic-regression-y-x1-x2-on-the-training-set-model1" class="level3" data-number="1.6.1">
<h3 data-number="1.6.1" class="anchored" data-anchor-id="fit-a-logistic-regression-y-x1-x2-on-the-training-set-model1"><span class="header-section-number">1.6.1</span> Fit a logistic regression (Y ~ x1 + x2) on the training set (model1)</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(train_class_1, train_class_0a, train_class_0b) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.factor</span>(Y))</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co">#test dataset</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(test_class_1, test_class_0a, test_class_0b) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">as.factor</span>(Y))</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co"># logistic regression</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2, <span class="at">data=</span>train_data, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co"># more complex logistic regression</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Y<span class="sc">~</span>x1<span class="sc">+</span>x2<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">*</span>x2)<span class="sc">+</span><span class="fu">I</span>(x1<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(x2<span class="sc">^</span><span class="dv">2</span>), <span class="at">data=</span>train_data, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Assess the misclassification error on the testing set.</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="co">#model 1 prediction</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>model1_pred <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(model1, <span class="at">newdata =</span> test_data, <span class="at">type.predict =</span> <span class="st">"response"</span>)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="co">#model 2 prediction</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>model2_pred <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(model2, <span class="at">newdata =</span> test_data, <span class="at">type.predict =</span> <span class="st">"response"</span>)</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ROCR"</span>)</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="co"># model1</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(model1_pred<span class="sc">$</span>.fitted, test_data<span class="sc">$</span>Y)</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"tpr"</span>, <span class="at">x.measure =</span> <span class="st">"fpr"</span>)</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf, <span class="at">main=</span><span class="st">"ROC curve Admissions"</span>, <span class="at">xlab=</span><span class="st">"Specificity"</span>,</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Sensitivity"</span>, <span class="at">col =</span> <span class="st">"darkorange"</span>)</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="co">#add a 45 degree line</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a><span class="co"># compute empirical AUC with ROCR for base logit model</span></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>auc_model1 <span class="ot">&lt;-</span> ROCR<span class="sc">::</span><span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"auc"</span>)</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>auc_model1 <span class="ot">&lt;-</span> auc_model1<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a><span class="co"># model2</span></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(model2_pred<span class="sc">$</span>.fitted, test_data<span class="sc">$</span>Y)</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"tpr"</span>, <span class="at">x.measure =</span> <span class="st">"fpr"</span>)</span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">main=</span><span class="st">"ROC curve Admissions"</span>, <span class="at">xlab=</span><span class="st">"Specificity"</span>, <span class="at">ylab=</span><span class="st">"Sensitivity"</span>, <span class="at">col =</span> <span class="st">"darkolivegreen"</span>)</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>auc_model2 <span class="ot">&lt;-</span> ROCR<span class="sc">::</span><span class="fu">performance</span>(pred, <span class="at">measure =</span> <span class="st">"auc"</span>)</span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>auc_model2 <span class="ot">&lt;-</span> auc_model2<span class="sc">@</span>y.values[[<span class="dv">1</span>]]</span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="fl">0.6</span>,<span class="fl">0.6</span>,</span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">'model1'</span>, <span class="st">'model2'</span>),</span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">"darkorange"</span>, <span class="st">"darkolivegreen"</span>),<span class="at">lwd=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>auc_model1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9354</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>auc_model2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.965526</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>model1_error_rate <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(model1, <span class="at">data =</span> train_data, <span class="at">newdata =</span> test_data, <span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">type.residuals =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">predict_glm =</span> <span class="dv">1</span><span class="sc">*</span>(.fitted <span class="sc">&gt;=</span> <span class="fl">0.5</span>), <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>predict_glm, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>model2_error_rate <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(model2, <span class="at">data =</span> train_data, <span class="at">newdata =</span> test_data, <span class="at">type.predict =</span> <span class="st">"response"</span>, <span class="at">type.residuals =</span> <span class="st">"deviance"</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="fu">if_else</span>(Y <span class="sc">==</span> <span class="st">"BLUE"</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">predict_glm =</span> <span class="dv">1</span><span class="sc">*</span>(.fitted <span class="sc">&gt;=</span> <span class="fl">0.5</span>), <span class="at">l01 =</span> <span class="fu">if_else</span>(Y<span class="sc">==</span>predict_glm, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>model1_misclassification_error <span class="ot">&lt;-</span> model1_error_rate <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">|&gt;</span> <span class="fu">pull</span>(l01)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>model2_misclassification_error <span class="ot">&lt;-</span> model2_error_rate <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">l01 =</span> <span class="fu">mean</span>(l01)) <span class="sc">|&gt;</span> <span class="fu">pull</span>(l01)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating Table for results</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>misclassification_errors <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(model1_misclassification_error, model2_misclassification_error), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Set row names and column names</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(misclassification_errors) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"model1"</span>, <span class="st">"model2"</span>)</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(misclassification_errors) <span class="ot">&lt;-</span> <span class="st">"Misclassification Error"</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the matrix to a df for better readability</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>misclassification_errors_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(misclassification_errors)</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(misclassification_errors_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       Misclassification Error
model1                  0.5275
model2                  0.5125</code></pre>
</div>
</div>
<p>We see model2 performing slightly better, i.e.&nbsp;having a lower misclassification rate. Thus this model is preferred over model1.</p>
</section>
<section id="boundary-decision-and-bayes-classifier" class="level3" data-number="1.6.2">
<h3 data-number="1.6.2" class="anchored" data-anchor-id="boundary-decision-and-bayes-classifier"><span class="header-section-number">1.6.2</span> Boundary decision and bayes classifier</h3>
<p>to get the bayes boundary decision we do the following:</p>
<p><strong>Derive the Bayes Decision Boundary</strong>:</p>
<ul>
<li>The Bayes decision boundary is derived from the posterior probabilities of the two classes. If we have two classes, 0 and 1, and we denote the class conditional densities as <span class="math inline">\(p(x∣Y=0)\)</span> and <span class="math inline">\(p(x∣Y=1)\)</span>, then the Bayes decision boundary occurs where the posterior probabilities are equal:</li>
</ul>
<p><span class="math inline">\(P(Y=0∣X=x)=P(Y=1∣X=x)P(Y = 0 | X = x)\)</span></p>
<p>This can be rewritten as:</p>
<p><span class="math inline">\(p(x∣Y=0)⋅P(Y=0)=p(x∣Y=1)⋅P(Y=1)\)</span></p>
<p>In this case we have a data generating process where the multivariate gaussian distribution has no cross correlation, our <span class="math inline">\(\sigma_{1,2}\)</span> and <span class="math inline">\(\sigma_{2,1}\)</span> terms in our variance-covariance matrix <span class="math inline">\(\sum_0\)</span> and <span class="math inline">\(\sum_1\)</span> are <span class="math inline">\(0\)</span>. This implies, that to get the joint probability of being in class a or in class b, we can just add the marginal probabilities of being in class a or b respectively. This probability can then be compared to the probability of being in the other class, class 1. Thus, the higher probability will determine the estimate of Y for the bayesian estimator. Naturally, in our function, we use the definition of the PDF of the multivariate normal distribution <span class="math display">\[ f_{\boldsymbol{X}} (x_1, x_2) =  \frac{1}{(2 \pi)^{1/2} (\det(\sum))^{1/2}} \exp{(-\frac{1}{2} (x- \mu)^T (\sum)^{-1}(x- \mu))} \]</span>.</p>
<p>Find below the Decision Boundary plot.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="fu">min</span>(test_data<span class="sc">$</span>x1), <span class="fu">max</span>(test_data<span class="sc">$</span>x1), .<span class="dv">1</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="fu">min</span>(test_data<span class="sc">$</span>x2), <span class="fu">max</span>(test_data<span class="sc">$</span>x2), .<span class="dv">1</span>)) <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># coarse grid for mimicking ESL figures (little dots)</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x1 =</span> <span class="fu">seq</span>(<span class="fu">min</span>(test_data<span class="sc">$</span>x1), <span class="fu">max</span>(test_data<span class="sc">$</span>x1), .<span class="dv">2</span>), <span class="at">x2 =</span> <span class="fu">seq</span>(<span class="fu">min</span>(test_data<span class="sc">$</span>x2), <span class="fu">max</span>(test_data<span class="sc">$</span>x2), .<span class="dv">2</span>)) <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define means and covariance matrices</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>m01 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>m02 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">4</span>)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">0</span>)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>std01 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>), <span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>std02 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>), <span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>std1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">4</span>), <span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to compute the Gaussian probability density</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>gaussian_pdf <span class="ot">&lt;-</span> <span class="cf">function</span>(x, mean, sigma) {</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">length</span>(mean)</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>  coef <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> ((<span class="dv">2</span> <span class="sc">*</span> pi)<span class="sc">^</span>(d <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">det</span>(sigma)))</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>  exponent <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">t</span>(x <span class="sc">-</span> mean) <span class="sc">%*%</span> <span class="fu">solve</span>(sigma) <span class="sc">%*%</span> (x <span class="sc">-</span> mean)</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(coef <span class="sc">*</span> <span class="fu">exp</span>(exponent))</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a><span class="co"># function for our bayesian estimator</span></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>predict_oracle <span class="ot">&lt;-</span> <span class="cf">function</span>(x1, x2) {</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">c</span>(x1, x2)</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>  likelihood_class0_1 <span class="ot">&lt;-</span> <span class="fu">gaussian_pdf</span>(x, m01, std01)</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>  likelihood_class0_2 <span class="ot">&lt;-</span> <span class="fu">gaussian_pdf</span>(x, m02, std02)</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>  likelihood_class1 <span class="ot">&lt;-</span> <span class="fu">gaussian_pdf</span>(x, m1, std1)</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>  likelihood_class0 <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">*</span> (likelihood_class0_1 <span class="sc">+</span> likelihood_class0_2)</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">*</span> (likelihood_class0 <span class="sc">-</span> likelihood_class1 <span class="sc">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a>predict_oracle_V <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(predict_oracle)</span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> grid <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a>grid_background <span class="ot">&lt;-</span> grid_background <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">predict_oracle =</span> <span class="fu">predict_oracle_V</span>(x1, x2))</span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>m1_predict_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(new_data) {</span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>  outcome <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(model1, <span class="at">newdata =</span> new_data, <span class="at">type.predict =</span> <span class="st">"response"</span>)</span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.vector</span>(outcome<span class="sc">$</span>.fitted)}</span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a>m2_predict_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(new_data) {</span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a>  outcome <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(model2, <span class="at">newdata =</span> new_data, <span class="at">type.predict =</span> <span class="st">"response"</span>)</span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.vector</span>(outcome<span class="sc">$</span>.fitted)}</span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">$</span>m1_predictions <span class="ot">&lt;-</span> <span class="fu">m1_predict_fn</span>(grid)</span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a>grid<span class="sc">$</span>m2_predictions <span class="ot">&lt;-</span> <span class="fu">m2_predict_fn</span>(grid)</span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(grid) <span class="sc">+</span> </span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> predict_oracle),</span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'darkgrey'</span>) <span class="sc">+</span></span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> m1_predictions),</span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'darkgreen'</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">z =</span> m2_predictions),</span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true" tabindex="-1"></a>             <span class="at">breaks =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">'purple'</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb62-60"><a href="#cb62-60" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> test_data, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> Y),</span>
<span id="cb62-61"><a href="#cb62-61" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="st">"o"</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb62-62"><a href="#cb62-62" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_point</span>(<span class="at">data =</span> grid_background,</span>
<span id="cb62-63"><a href="#cb62-63" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> x2, <span class="at">col =</span> <span class="fu">as.factor</span>(predict_oracle)),</span>
<span id="cb62-64"><a href="#cb62-64" aria-hidden="true" tabindex="-1"></a>           <span class="at">shape =</span> <span class="dv">20</span>, <span class="at">size =</span> .<span class="dv">05</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb62-65"><a href="#cb62-65" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dodgerblue"</span>, <span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb62-66"><a href="#cb62-66" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Case_Study_1_in_class_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As shown above, we see the Bayes boundary decision optimally cutting the data, with the simple model1 being shown in dark green and model2 being shown in purple.</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>